{"version":3,"sources":["../../../../server/api/user/user.controller.js"],"names":[],"mappings":"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","file":"user.controller.js","sourcesContent":["'use strict';\n\nimport User from './user.model'\nimport passport from 'passport'\nimport config from '../../config/environment'\nimport jwt from 'jsonwebtoken'\n\nfunction validationError(res, statusCode) {\n    statusCode = statusCode || 422\n    return function(err) {\n        res.status(statusCode).json(err)\n    }\n}\n\nfunction handleError(res, statusCode) {\n    statusCode = statusCode || 500\n    return function(err) {\n        res.status(statusCode).send(err)\n    }\n}\n\n/**\n * Get list of users\n * restriction: 'admin'\n */\nexport function index(req, res) {\n    return User.find({}, '-salt -password').exec()\n        .then(users => {\n            res.status(200).json(users)\n        })\n        .catch(handleError(res))\n}\n\n/**\n * Creates a new user\n */\nexport function create(req, res, next) {\n    var newUser = new User(req.body)\n\n    newUser.provider = 'local'\n    newUser.role = 'user'\n\n    /*\n     * Check to see if e-mail is yuujin.lee@gmail.com\n     * to change role to Admin\n     */\n\n    if (newUser.email === 'yuujin.lee@gmail.com') {\n        newUser.role = 'admin'\n    }\n\n    newUser.save()\n        .then(function(user) {\n            var token = jwt.sign({ _id: user._id }, config.secrets.session, {\n                expiresIn: 60 * 60 * 5\n            })\n            res.json({ token })\n        })\n        .catch(validationError(res))\n}\n\n/**\n * Get a single user\n */\nexport function show(req, res, next) {\n    var userId = req.params.id\n\n    return User.findById(userId).exec()\n        .then(user => {\n            if (!user) {\n                return res.status(404).end()\n            }\n            res.json(user.profile)\n        })\n        .catch(err => next(err))\n}\n\n/**\n * Deletes a user\n * restriction: 'admin'\n */\nexport function destroy(req, res) {\n    return User.findByIdAndRemove(req.params.id).exec()\n        .then(function() {\n            res.status(204).end()\n        })\n        .catch(handleError(res))\n}\n\n/**\n * Change a users password\n */\nexport function changePassword(req, res, next) {\n    var userId = req.user._id\n    var oldPass = String(req.body.oldPassword)\n    var newPass = String(req.body.newPassword)\n\n    return User.findById(userId).exec()\n        .then(user => {\n            if (user.authenticate(oldPass)) {\n                user.password = newPass\n                return user.save()\n                    .then(() => {\n                        res.status(204).end()\n                    })\n                    .catch(validationError(res))\n            } else {\n                return res.status(403).end()\n            }\n        })\n}\n\n/**\n * Get my info\n */\nexport function me(req, res, next) {\n    var userId = req.user._id\n\n    return User.findOne({ _id: userId }, '-salt -password').exec()\n        .then(user => { // don't ever give out the password or salt\n            if (!user) {\n                return res.status(401).end()\n            }\n            res.json(user)\n        })\n        .catch(err => next(err))\n}\n\n/**\n * Authentication callback\n */\nexport function authCallback(req, res, next) {\n    res.redirect('/')\n}\n"]}