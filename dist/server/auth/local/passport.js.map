{"version":3,"sources":["../../../../server/auth/local/passport.js"],"names":[],"mappings":";;;;;QA2BgB;;AA3BhB;;;;AACA;;;;AAEA,SAAS,iBAAT,CAA2B,IAA3B,EAAiC,KAAjC,EAAwC,QAAxC,EAAkD,IAAlD,EAAwD;AACpD,SAAK,OAAL,CAAa;AACL,eAAO,MAAM,WAAN,EAAP;KADR,EAEO,IAFP,GAGK,IAHL,CAGU,gBAAQ;AACV,YAAI,CAAC,IAAD,EAAO;AACP,mBAAO,KAAK,IAAL,EAAW,KAAX,EAAkB;AACrB,yBAAS,+BAAT;aADG,CAAP,CADO;SAAX;AAKA,aAAK,YAAL,CAAkB,QAAlB,EAA4B,UAAS,SAAT,EAAoB,aAApB,EAAmC;AAC3D,gBAAI,SAAJ,EAAe;AACX,uBAAO,KAAK,SAAL,CAAP,CADW;aAAf;AAGA,gBAAI,CAAC,aAAD,EAAgB;AAChB,uBAAO,KAAK,IAAL,EAAW,KAAX,EAAkB,EAAE,SAAS,+BAAT,EAApB,CAAP,CADgB;aAApB,MAEO;AACH,uBAAO,KAAK,IAAL,EAAW,IAAX,CAAP,CADG;aAFP;SAJwB,CAA5B,CANU;KAAR,CAHV,CAoBK,KApBL,CAoBW;eAAO,KAAK,GAAL;KAAP,CApBX,CADoD;CAAxD;;AAwBO,SAAS,KAAT,CAAe,IAAf,EAAqB,MAArB,EAA6B;AAChC,uBAAS,GAAT,CAAa,4BAAkB;AAC3B,uBAAe,OAAf;AACA,uBAAe,UAAf;AAF2B,KAAlB,EAGV,UAAS,KAAT,EAAgB,QAAhB,EAA0B,IAA1B,EAAgC;AAC/B,eAAO,kBAAkB,IAAlB,EAAwB,KAAxB,EAA+B,QAA/B,EAAyC,IAAzC,CAAP,CAD+B;KAAhC,CAHH,EADgC;CAA7B","file":"passport.js","sourcesContent":["import passport from 'passport'\nimport { Strategy as LocalStrategy } from 'passport-local'\n\nfunction localAuthenticate(User, email, password, done) {\n    User.findOne({\n            email: email.toLowerCase()\n        }).exec()\n        .then(user => {\n            if (!user) {\n                return done(null, false, {\n                    message: 'This email is not registered.'\n                })\n            }\n            user.authenticate(password, function(authError, authenticated) {\n                if (authError) {\n                    return done(authError)\n                }\n                if (!authenticated) {\n                    return done(null, false, { message: 'This password is not correct.' })\n                } else {\n                    return done(null, user)\n                }\n            })\n        })\n        .catch(err => done(err))\n}\n\nexport function setup(User, config) {\n    passport.use(new LocalStrategy({\n        usernameField: 'email',\n        passwordField: 'password' // this is the virtual field on the model\n    }, function(email, password, done) {\n        return localAuthenticate(User, email, password, done)\n    }))\n}\n"]}